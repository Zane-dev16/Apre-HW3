\documentclass{article}

\usepackage{amsmath, amsthm, amssymb, amsfonts}
\usepackage{thmtools}
\usepackage{graphicx}
\usepackage{setspace}
\usepackage{geometry}
\usepackage{float}
\usepackage{hyperref}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{framed}
\usepackage[dvipsnames]{xcolor}
\usepackage[most]{tcolorbox}
\usepackage{minted}
\usepackage{enumitem}

\usepackage{indentfirst}

\usepackage[export]{adjustbox} % Align images

\colorlet{LightGray}{White!90!Periwinkle}
\colorlet{LightOrange}{Orange!15}
\colorlet{LightGreen}{Green!15}

\newcommand{\HRule}[1]{\rule{\linewidth}{#1}}

\newtcbtheorem[auto counter,number within=section]{code}{Código}{
  colback=LightOrange!20,
  colframe=LightOrange,
  colbacktitle=LightOrange,
  fonttitle=\bfseries\color{black},
  boxed title style={size=small,colframe=LightOrange},
}{code}

\setstretch{1.2}
\geometry{
  textheight=22.5cm,
  textwidth=13.75cm,
  top=2.5cm,
  headheight=12pt,
  headsep=25pt,
  footskip=30pt
}

% ------------------------------------------------------------------------------

\begin{document}

% ------------------------------------------------------------------------------
% Cover Page and ToC
% ------------------------------------------------------------------------------
\begin{center}
  \begin{figure}
    \includegraphics[scale = 0.3, left]{img/IST_A.eps} % IST logo
    \end{figure}
  \LARGE{ \normalsize \textsc{} \\
  [2.0cm] 
  \LARGE{ \LARGE \textsc{Aprendizagem}} \\
  [1cm]
  \LARGE{ \LARGE \textsc{LEIC IST-UL}} \\
  [1cm]
  \HRule{1.5pt} \\
  [0.4cm]
  \LARGE \textbf{\uppercase{Relatório - Homework 3}}
  \HRule{1.5pt}
  \\ [2.5cm]
  }
\end{center}

\begin{flushleft}
  \textbf{\LARGE Grupo 10:}
\end{flushleft}

\begin{center}
  \begin{minipage}{0.7\textwidth}
      \begin{flushleft}
        \large Gabriel Ferreira \\
        \large  Irell Zane
      \end{flushleft}
  \end{minipage}%
  \begin{minipage}{0.3\textwidth}
      \begin{flushright}
        \large 107030\\
        \large 107161
      \end{flushright}
  \end{minipage}
\end{center}

\begin{center}
  \vspace{4cm}
  \date \large \bf  2024/2025 -- 1st Semester, P1
\end{center}

\setcounter{page}{0}
\thispagestyle{empty}
\renewcommand{\thesection}{\Roman{section}}

\newpage

% ------------------------------------------------------------------------------
% Content
% ------------------------------------------------------------------------------



\large{\textbf{Part I}: Pen and paper}\normalsize

\begin{enumerate}[leftmargin=\labelsep]
\item 

Given the polynomial basis function:

\[\phi(y_1, y_2) = y_1 \times y_2\]

We apply this to our input data:

\begin{align*}
x_1: \phi(1, 1) &= 1 \times 1 = 1 \\
x_2: \phi(1, 3) &= 1 \times 3 = 3 \\
x_3: \phi(3, 2) &= 3 \times 2 = 6 \\
x_4: \phi(3, 3) &= 3 \times 3 = 9 \\
x_5: \phi(2, 4) &= 2 \times 4 = 8
\end{align*}

For OLS, we need $\mathbf{X}$ (input) and $\mathbf{y}$ (output) matrices:

\[\mathbf{X} = \begin{bmatrix}
1 & 1 \\
1 & 3 \\
1 & 6 \\
1 & 9 \\
1 & 8
\end{bmatrix}\]

\[\mathbf{z} = \begin{bmatrix}
1.25 \\
7.0 \\
2.7 \\
3.2 \\
5.5
\end{bmatrix}\]

\textbf{OLS closed form solution calculation}

The OLS closed form solution is given by:

\[\boldsymbol{w} = (\mathbf{X}^T \mathbf{X})^{-1} \mathbf{X}^T \mathbf{z}\]

Calculation of the separate components of formula:

\[
\mathbf{X}^T \mathbf{X} = 
\begin{bmatrix}
1 & 1 & 1 & 1 & 1 \\
1 & 3 & 6 & 9 & 8
\end{bmatrix}
\begin{bmatrix}
1 & 1 \\
1 & 3 \\
1 & 6 \\
1 & 9 \\
1 & 8
\end{bmatrix}
=
\begin{bmatrix}
5 & 27 \\
27 & 191
\end{bmatrix}
\]

\[(\mathbf{X}^T \mathbf{X})^{-1} \approx \begin{bmatrix}
0.845 & -0.119 \\
-0.119 & 0.022
\end{bmatrix}\]

\[\mathbf{X}^T \mathbf{z} = \begin{bmatrix}
19.65 \\
111.25
\end{bmatrix}\]

Finally,

\[\boldsymbol{w} = (\mathbf{X}^T \mathbf{X})^{-1} \mathbf{X}^T \mathbf{z}\]
\[= \begin{bmatrix}
0.845 & -0.119 \\
-0.119 & 0.022
\end{bmatrix} \times \begin{bmatrix}
19.65 \\
111.25
\end{bmatrix}\]

\[\approx \begin{bmatrix}
3.316\\
0.114
\end{bmatrix}\]

Therefore, the regression model in the transformed space is:

\[y_{num} = 3.316 + 0.114 \times \phi(y_1, y_2)\]

\item 
\textbf{Ridge regression closed form solution calculation}\\
The ridge regression closed form solution with penalty factor $\lambda$ = 1 is given by:
\[\boldsymbol{w} = (\mathbf{X}^T \mathbf{X} + \lambda \mathbf{I})^{-1} \mathbf{X}^T \mathbf{z}\]
Calculation of the separate components of formula:
\[
\mathbf{X}^T \mathbf{X} = 
\begin{bmatrix}
1 & 1 & 1 & 1 & 1 \\
1 & 3 & 6 & 9 & 8
\end{bmatrix}
\begin{bmatrix}
1 & 1 \\
1 & 3 \\
1 & 6 \\
1 & 9 \\
1 & 8
\end{bmatrix}
=
\begin{bmatrix}
5 & 27 \\
27 & 191
\end{bmatrix}
\]
\[\mathbf{X}^T \mathbf{X} + \lambda \mathbf{I} = \begin{bmatrix}
5 & 27 \\
27 & 191
\end{bmatrix} + \begin{bmatrix}
1 & 0 \\
0 & 1
\end{bmatrix} = \begin{bmatrix}
6 & 27 \\
27 & 192
\end{bmatrix}\]
\[(\mathbf{X}^T \mathbf{X} + \lambda \mathbf{I})^{-1} \approx \begin{bmatrix}
0.454 & -0.064 \\
-0.064 & 0.014
\end{bmatrix}\]
\[\mathbf{X}^T \mathbf{z} = \begin{bmatrix}
19.65 \\
111.25
\end{bmatrix}\]
Finally,
\[\boldsymbol{w} = (\mathbf{X}^T \mathbf{X} + \lambda \mathbf{I})^{-1} \mathbf{X}^T \mathbf{z}\]
\[= \begin{bmatrix}
0.454 & -0.064 \\
-0.064 & 0.014
\end{bmatrix} \times \begin{bmatrix}
19.65 \\
111.25
\end{bmatrix}\]
\[\approx \begin{bmatrix}
1.818\\
0.324
\end{bmatrix}\]
Therefore, the ridge regression model in the transformed space with $\sigma$ = 1 is:
\[y_{num} = 1.818 + 0.324 \times \phi(y_1, y_2)\]

The impact of ridge regression on the coefficients can be observed by comparing the Ordinary Least Squares (OLS) solution with the ridge regression solution (using $\lambda = 1$):

\begin{align*}
\text{OLS coefficients:} & \quad \boldsymbol{w}_{\text{OLS}} \approx \begin{bmatrix} 3.316 \\ 0.114 \end{bmatrix} \\[10pt]
\text{Ridge coefficients:} & \quad \boldsymbol{w}_{\text{Ridge}} \approx \begin{bmatrix} 1.818 \\ 0.324 \end{bmatrix}
\end{align*}

The effects of ridge regression are as follows:
The larger coefficient (intercept) has been substantially reduced from 3.316 to 1.818.
The smaller coefficient increased from.
This aligns with the primary goal of ridge regression to shrink large coefficients, which are more heavily penalized due to the quadratic regularization term.

Ultimately the Ridge regression has reduced the sum of squared coefficients:
\begin{align*}
\text{OLS:} & \quad 3.316^2 + 0.114^2 \approx 11.00 \\
\text{Ridge:} & \quad 1.818^2 + 0.324^2 \approx 3.41
\end{align*}
This significant reduction in the sum of squared coefficients indicates a less complex model, which is likely to generalize better to unseen data.

\item 
\textbf{OLS and Ridge prediction calculations}\\

For $x_1 = (1, 1)$:
\begin{align*}
\phi(1, 1) &= 1 \times 1 = 1 \\
y_{OLS} &= 3.316 + 0.114 \times 1 = 3.430 \\
y_{Ridge} &= 1.818 + 0.324 \times 1 = 2.142
\end{align*}

For $x_2 = (1, 3)$:
\begin{align*}
\phi(1, 3) &= 1 \times 3 = 3 \\
y_{OLS} &= 3.316 + 0.114 \times 3 = 3.658 \\
y_{Ridge} &= 1.818 + 0.324 \times 3 = 2.790
\end{align*}

For $x_3 = (3, 2)$:
\begin{align*}
\phi(3, 2) &= 3 \times 2 = 6 \\
y_{OLS} &= 3.316 + 0.114 \times 6 = 4.000 \\
y_{Ridge} &= 1.818 + 0.324 \times 6 = 3.762
\end{align*}

For $x_4 = (3, 3)$:
\begin{align*}
\phi(3, 3) &= 3 \times 3 = 9 \\
y_{OLS} &= 3.316 + 0.114 \times 9 = 4.342 \\
y_{Ridge} &= 1.818 + 0.324 \times 9 = 4.734
\end{align*}

For $x_5 = (2, 4)$:
\begin{align*}
\phi(2, 4) &= 2 \times 4 = 8 \\
y_{OLS} &= 3.316 + 0.114 \times 8 = 4.228 \\
y_{Ridge} &= 1.818 + 0.324 \times 8 = 4.410
\end{align*}


For $x_6 = (2, 2, 0.7)$:
\begin{align*}
\phi(2, 2) &= 2 \times 2 = 4 \\
y_{OLS} &= 3.316 + 0.114 \times 4 = 3.772 \\
y_{Ridge} &= 1.818 + 0.324 \times 4 = 3.114
\end{align*}

For $x_7 = (1, 2, 1.1)$:
\begin{align*}
\phi(1, 2) &= 1 \times 2 = 2 \\
y_{OLS} &= 3.316 + 0.114 \times 2 = 3.544 \\
y_{Ridge} &= 1.818 + 0.324 \times 2 = 2.466
\end{align*}

For $x_8 = (5, 1, 2.2)$:
\begin{align*}
\phi(5, 1) &= 5 \times 1 = 5 \\
y_{OLS} &= 3.316 + 0.114 \times 5 = 3.886 \\
y_{Ridge} &= 1.818 + 0.324 \times 5 = 3.438
\end{align*}

\textbf{Train RMSE calculation}

\begin{align*}
RMSE_{OLS} &= \sqrt{\frac{1}{5}\sum_{i=1}^5 (y_i - \hat{y}_i)^2} \\
&= \sqrt{\frac{1}{5}[(1.25 - 3.430)^2 + (7 - 3.658)^2 + (2.7 - 4.000)^2 + (3.2 - 4.342)^2 + (5.5 - 4.228)^2]} \\
&= \sqrt{\frac{1}{5}[(-2.180)^2 + (3.342)^2 + (-1.300)^2 + (-1.142)^2 + (1.272)^2]} \\
&= \sqrt{\frac{1}{5}[4.7524 + 11.1697 + 1.6900 + 1.3042 + 1.6188]} \\
&= \sqrt{\frac{1}{5} \times 20.5351} \\
&\approx 2.027
\end{align*}

\begin{align*}
RMSE_{Ridge} &= \sqrt{\frac{1}{5}\sum_{i=1}^5 (y_i - \hat{y}_i)^2} \\
&= \sqrt{\frac{1}{5}[(1.25 - 2.142)^2 + (7 - 2.790)^2 + (2.7 - 3.762)^2 + (3.2 - 4.734)^2 + (5.5 - 4.410)^2]} \\
&= \sqrt{\frac{1}{5}[(-0.892)^2 + (4.210)^2 + (-1.062)^2 + (-1.534)^2 + (1.090)^2]} \\
&= \sqrt{\frac{1}{5}[0.7953 + 17.7321 + 1.1278 + 2.3524 + 1.1881]} \\
&= \sqrt{\frac{1}{5} \times 23.1957} \\
&\approx 2.154
\end{align*}


\textbf{Test RMSE calculation}

\begin{align*}
RMSE_{OLS} &= \sqrt{\frac{1}{3}\sum_{i=6}^8 (y_i - \hat{y}_i)^2} \\
&= \sqrt{\frac{1}{3}[(0.7 - 3.772)^2 + (1.1 - 3.544)^2 + (2.2 - 3.886)^2]} \\
&\approx 2.467
\end{align*}

\begin{align*}
RMSE_{Ridge} &= \sqrt{\frac{1}{3}\sum_{i=6}^8 (y_i - \hat{y}_i)^2} \\
&= \sqrt{\frac{1}{3}[(0.7 - 3.114)^2 + (1.1 - 2.466)^2 + (2.2 - 3.438)^2]} \\
&\approx 1.748
\end{align*}

The results show that the Ridge regression model has a lower test RMSE and a higher train RMSE compared to the original OLS model for the given train data. This shows that the original OLS model overfits more than the Ridge regression model. This aligns with our expectations as the objective of the regularization in ridge regression was so that the model overfits the training data less and generalize better for unseen data.

\item We you get to the next problem, you can end the enumerate for the parts of the previous problem and then add another item.
    \begin{enumerate}
    \item Use a nested enumerate environment to label the parts of the next problem.
    \item For a quick and broad overview of how to create documents in {\LaTeX} see 
    \href{https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes}{this quick tutorial from Overleaf}.
    \end{enumerate}
\end{enumerate}

\large{\textbf{Part II}: Programming}\normalsize

\begin{enumerate}[leftmargin=\labelsep,resume]
\item Solution to the programming questions here.
\end{enumerate}

\vskip 1cm
\textbf{End note}: do not forget to also submit your Jupyter notebook

\newpage

% ----------------------------------------------------------------------
% Cover
% ----------------------------------------------------------------------

\end{document}

